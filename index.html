<html>
<script src='https://d3js.org/d3.v5.min.js'></script>
<style> circle {fill: lightblue; stroke: black;} </style>
<body onload='init()'>
<svg width=1000 height=1000>
</svg>
<script>
async function init() {

  var dataByRegion = d3.nest()
  .key(function(d) { return d.region; })
  .rollup(function(v) { return {
    count: v.length,
    total: d3.sum(v, function(d) { return d.AveragePrice; }),
    avg: d3.mean(v, function(d) { return d.AveragePrice; })
  }; })
  .entries(data);
  
  console.log(dataByRegion);
 

 const data = await d3.csv('avocado.csv');
 var width = 1000;
 var height = 1000;
 var margin = 50;
 
 d3.select("svg")
.attr("width",width + 2*margin)
.attr("height",height + 2*margin)
.append("g")
.attr("transform","translate("+margin+","+margin+")")
 
   // Initialize the circle: all located at the center of the svg area
var node = d3.select('svg').append("g")
  .selectAll("circle")
  .data(dataByRegion)
  .enter()
  .append("circle")
    .attr("r", function(d) {return +d.value.avg*10;})
    .attr("cx", 500)
    .attr("cy", 500)
    .style("fill", "#69b3a2")
    .style("fill-opacity", 0.3)
    .attr("stroke", "#69a2b2")
    .style("stroke-width", 4)
  // Features of the forces applied to the nodes:
var simulation = d3.forceSimulation()
    .force("center", d3.forceCenter().x(500).y(500)) // Attraction to the center of the svg area
    .force("charge", d3.forceManyBody().strength(0.5)) // Nodes are attracted one each other of value is > 0
    .force("collide", d3.forceCollide().strength(.01).radius(30).iterations(1)) // Force that avoids circle overlapping

// Apply these forces to the nodes and update their positions.
// Once the force algorithm is happy with positions ('alpha' value is low enough), simulations will stop.
simulation
    .nodes(data)
    .on("tick", function(d){
      node
          .attr("cx", function(d){ return d.x; })
          .attr("cy", function(d){ return d.y; })
    }); 
  
}
</script>
</body>
</html>
