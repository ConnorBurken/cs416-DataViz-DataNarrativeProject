<html>
 <head>
   <script src='https://d3js.org/d3.v5.min.js'></script>
   <script src="https://d3js.org/d3-array.v2.min.js"></script>
   <!-- Load d3-annotation -->
   <script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>
   <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
   <title> Avocado Metrics From 2015 to 2018 </title>
 </head>
<body>


 <h1>Avocado Total Volume in Bags From 2015 to 2018</h1>
 <p>Avocados are a delicious superfood that have only grown in popularity over the last years.
    This data narrative examines how avocados prices and volume differ by region and by season.</p>


 <nav aria-label="Page navigation example">
  <ul class="pagination">
    <li class="page-item">
      <a class="page-link" href="./" aria-label="Previous">
        <span aria-hidden="true">&laquo;</span>
        <span class="sr-only">Previous</span>
      </a>
    </li>
    <li class="page-item"><a class="page-link" href="./">1</a></li>
    <li class="page-item"><a class="page-link" href="./AvacadoByVolume.html">2</a></li>
    <li class="page-item"><a class="page-link" href="./AvacadoVolumeOfBags.html">3</a></li>
    <li class="page-item">
      <a class="page-link" href="./AvacadoVolumeOfBags.html" aria-label="Next">
        <span aria-hidden="true">&raquo;</span>
        <span class="sr-only">Next</span>
      </a>
    </li>
  </ul>
</nav>


 <svg width=1500 height=1000></svg>



 <script>
   const data = d3.csv('avocado.csv').then(function(data){
      var width = 1000;
      var height = 1000;
      var margin = 50;
      var svg = d3.select("svg");
      var parseTime = d3.timeParse("%m/%d/%y");//Function to parse time into JS format
      var currType = "conventional";



      // format the data
      data.forEach(function(d) {
            d.Date = parseTime(d.Date);
            d.AveragePrice = +d.AveragePrice;
        });

     var dataByYear = d3.group(data, d=>d.year);

     var dataSmallBags = d3.nest()
          .key(function(d) { return d.year; })
          .rollup(function(v) { return {
             count: v.length,
             total: d3.sum(v, function(d) { return d.SmallBags; }),
             avg: d3.mean(v, function(d) { return d.SmallBags; })
           }; }).entries(data);

        console.log(dataSmallBags);

           var dataLargeBags =d3.nest()
                .key(function(d) { return d.year; })
                .rollup(function(v) { return {
                   count: v.length,
                   total: d3.sum(v, function(d) { return d.LargeBags; }),
                   avg: d3.mean(v, function(d) { return d.LargeBags; })
                 }; }).entries(data);

                 var dataXLargeBags = d3.nest()
                      .key(function(d) { return d.year; })
                      .rollup(function(v) { return {
                         count: v.length,
                         total: d3.sum(v, function(d) { return d.XLargeBags; }),
                         avg: d3.mean(v, function(d) { return d.XLargeBags; })
                       }; }).entries(data);



           // set the dimensions and margins of the graph
       var width = 300
           height = 300
           margin = 40

       // The radius of the pieplot is half the width or half the height (smallest one). I subtract a bit of margin.
       var radius = Math.min(width, height) / 2 - margin

       // append the svg object to the div called 'my_dataviz'
       var svg = d3.select("svg");

       svg.append("text")
          .attr("x", 180)
          .attr("y", 200)
          .text("2015");

          svg.append("text")
             .attr("x", 480)
             .attr("y", 200)
             .text("2016");

             svg.append("text")
                .attr("x", 780)
                .attr("y", 200)
                .text("2017");

                svg.append("text")
                   .attr("x", 1080)
                   .attr("y", 200)
                   .text("2018");

       // Create dummy data
       var pieData = {smallBags: dataSmallBags[0].value.total, largeBags: dataLargeBags[0].value.total, xLargeBags:dataXLargeBags[0].value.total}

       // set the color scale
       var color = d3.scaleOrdinal()
         .domain(pieData)
         .range(["#6C8F32", "#F2E880", "#AA471F"]);


         svg.append("circle")
            .attr("cx",50)
            .attr("cy",400)
            .attr("r", 6)
            .style("fill", "#6C8F32");

         svg.append("text")
            .attr("x", 70)
            .attr("y", 400)
            .text("Small Bags")
            .style("font-size", "15px")
            .attr("alignment-baseline","middle");

            svg.append("circle")
               .attr("cx",150 + 50)
               .attr("cy",400)
               .attr("r", 6)
               .style("fill", "#F2E880");

            svg.append("text")
               .attr("x", 150 + 70)
               .attr("y", 400)
               .text("Large Bags")
               .style("font-size", "15px")
               .attr("alignment-baseline","middle");

               svg.append("circle")
                  .attr("cx",300 + 50)
                  .attr("cy",400)
                  .attr("r", 6)
                  .style("fill", "#AA471F");

               svg.append("text")
                  .attr("x", 300 + 70)
                  .attr("y", 400)
                  .text("Extra Large Bags")
                  .style("font-size", "15px")
                  .attr("alignment-baseline","middle");

       // Compute the position of each group on the pie:
       var pie = d3.pie()
         .value(function(d) {return d.value; })
       var data_ready = pie(d3.entries(pieData))

       // Build the pie chart: Basically, each part of the pie is a path that we build using the arc function.
       svg
         .selectAll('whatever')
         .data(data_ready)
         .enter()
         .append('path')
         .attr('d', d3.arc()
           .innerRadius(75)         // This is the size of the donut hole
           .outerRadius(radius)
         )
         .attr('fill', function(d){ return(color(d.data.key)) })
         .attr("stroke", "black")
         .attr("transform","translate(200,200)")
         .style("stroke-width", "2px")
         .style("opacity", 0.7)

         // Create dummy data
         var pieData = {smallBags: dataSmallBags[1].value.total, largeBags: dataLargeBags[1].value.total, xLargeBags:dataXLargeBags[1].value.total}

         var data_ready = pie(d3.entries(pieData))

         // Build the pie chart: Basically, each part of the pie is a path that we build using the arc function.
         svg
           .selectAll('whatever')
           .data(data_ready)
           .enter()
           .append('path')
           .attr('d', d3.arc()
             .innerRadius(75)         // This is the size of the donut hole
             .outerRadius(radius)
           )
           .attr('fill', function(d){ return(color(d.data.key)) })
           .attr("stroke", "black")
           .attr("transform","translate(500,200)")
           .style("stroke-width", "2px")
           .style("opacity", 0.7)

           // Create dummy data
           var pieData = {smallBags: dataSmallBags[2].value.total, largeBags: dataLargeBags[2].value.total, xLargeBags:dataXLargeBags[2].value.total}

           var data_ready = pie(d3.entries(pieData))

           // Build the pie chart: Basically, each part of the pie is a path that we build using the arc function.
           svg
             .selectAll('whatever')
             .data(data_ready)
             .enter()
             .append('path')
             .attr('d', d3.arc()
               .innerRadius(75)         // This is the size of the donut hole
               .outerRadius(radius)
             )
             .attr('fill', function(d){ return(color(d.data.key)) })
             .attr("stroke", "black")
             .attr("transform","translate(800,200)")
             .style("stroke-width", "2px")
             .style("opacity", 0.7)

             // Create dummy data
             var pieData = {smallBags: dataSmallBags[3].value.total, largeBags: dataLargeBags[3].value.total, xLargeBags:dataXLargeBags[3].value.total}

             var data_ready = pie(d3.entries(pieData))

             // Build the pie chart: Basically, each part of the pie is a path that we build using the arc function.
             svg
               .selectAll('whatever')
               .data(data_ready)
               .enter()
               .append('path')
               .attr('d', d3.arc()
                 .innerRadius(75)         // This is the size of the donut hole
                 .outerRadius(radius)
               )
               .attr('fill', function(d){ return(color(d.data.key)) })
               .attr("stroke", "black")
               .attr("transform","translate(1100,200)")
               .style("stroke-width", "2px")
               .style("opacity", 0.7)



//End of promise
});
</script>
</body>
</html>
